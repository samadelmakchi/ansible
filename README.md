# IaC (Infrastructure as Code)
به مفهومی اشاره دارد که زیرساخت‌های سیستم‌ها، شبکه‌ها، سرورها و سایر منابع فناوری اطلاعات به صورت کد مدیریت و پیکربندی می‌شوند. در این روش، به جای انجام دستی تنظیمات یا نصب و پیکربندی اجزا، همه این فرآیندها با استفاده از کدهای قابل اجرایی مانند اسکریپت‌ها یا فایل‌های پیکربندی انجام می‌شود. این رویکرد به کاهش خطاهای انسانی، افزایش تکرارپذیری و انعطاف‌پذیری در محیط‌های تولید کمک می‌کند و همچنین امکان اتوماسیون کامل فرآیندهای پیکربندی و مدیریت زیرساخت را فراهم می‌کند.

---

### 🤖 Ansible
آنسیبل یکی از ابزارهای محبوب برای پیاده‌سازی زیرساخت به عنوان کد است که برای اتوماسیون و مدیریت پیکربندی سیستم‌ها و سرورها استفاده می‌شود. این ابزار به‌وسیله‌ی زبان YAML (که به سادگی قابل فهم است) برای تعریف دستورالعمل‌ها و سناریوهای پیکربندی به کار می‌رود و به دلیل سادگی در استفاده و قابلیت مقیاس‌پذیری بالا محبوب است. آنسیبل بدون نیاز به نصب نرم‌افزار خاص روی سرورهای هدف، از طریق SSH به سیستم‌ها متصل می‌شود و عملیات مورد نظر را انجام می‌دهد، این ویژگی باعث می‌شود که آن را برای پروژه‌های کوچک تا بزرگ مناسب و قابل انعطاف کند.  
جهت نصب آنسیبل دستورات زیر را اجرا کنید.

```bash
sudo apt update
sudo apt install software-properties-common
sudo add-apt-repository ppa:ansible/ansible
sudo apt update

sudo apt install ansible -y
sudo apt install ansible-lint -y

ansible --version
ansible-lint --version
```

جهت اجرای پلی بوک آنسیبل از دستور زیر استفاده بکنید.
```bash
sudo ansible-playbook -i inventory_file.yml playbook.yml
```

برای آشنایی بیشتر با دستورات انسیبل، فایل [Ansible Cheat Sheet](./ansible_cheat_sheet.md) را مطالعه کنید.

---

### 🐳 Docker
داکر (Docker) یک پلتفرم کانتینرسازی سطح پایین و مبتنی بر فناوری‌های کرنل لینوکس مانند cgroups و namespaces است که امکان اجرای اپلیکیشن‌ها در محیطی ایزوله به‌نام کانتینر را فراهم می‌کند. برخلاف ماشین‌های مجازی، کانتینرها به‌طور مستقیم روی کرنل سیستم‌عامل میزبان اجرا می‌شوند و تنها شامل باینری‌ها و وابستگی‌های مورد نیاز اپلیکیشن هستند، که این موضوع باعث سبک‌تر بودن و مصرف منابع کمتر آن‌ها می‌شود. داکر از یک معماری کلاینت/سرور بهره می‌برد که در آن Docker Engine مسئول ساخت، اجرا و مدیریت کانتینرها است و Docker CLI یا API برای تعامل با آن استفاده می‌شود. همچنین با استفاده از Docker Compose می‌توان چند سرویس را به‌صورت تعریف‌شده در یک فایل YAML مدیریت کرد و با ترکیب آن با ابزارهایی مانند Kubernetes یا Swarm، امکان ارکستراسیون و مقیاس‌پذیری اپلیکیشن‌ها نیز فراهم می‌شود.  
برای نصب Docker با استفاده از پکیج‌ها، فایل [install_docker.sh](./install_docker.sh) را اجرا کنید.

---

### 🚦 Traefik
یک پروکسی معکوس (reverse proxy) و لود بالانسر مدرن و قدرتمند است که به‌طور ویژه برای محیط‌های داینامیک مانند Docker، Kubernetes، و سایر پلتفرم‌های ابری طراحی شده است. یکی از ویژگی‌های برجسته Traefik، توانایی کشف خودکار سرویس‌ها (Service Discovery) از طریق برقراری ارتباط با API پلتفرم‌های زیرساختی است؛ به این معنی که به محض اضافه یا حذف شدن یک سرویس، تنظیمات مربوط به روتینگ به‌صورت خودکار به‌روزرسانی می‌شود. Traefik از پروتکل‌های HTTP، HTTPS، TCP و حتی gRPC پشتیبانی می‌کند و به‌راحتی می‌تواند گواهی‌های TLS را به‌صورت خودکار از طریق Let’s Encrypt مدیریت کند. این ابزار به‌خاطر پیکربندی ساده، داشبورد گرافیکی کاربرپسند، و قابلیت ادغام با ابزارهایی مانند Docker Compose و Helm، در بین توسعه‌دهندگان و تیم‌های DevOps بسیار محبوب است.  
برای نصب Traefik دستورات زیر را اجرا کنید.
```bash
cd traefik
sudo docker compose up -d

sudo docker network create traefik_reverse_proxy
```

---

### 📄 Elasticsearch, Kibana, Fluentd, Beats
در یک معماری مدرن برای جمع‌آوری، ذخیره و مانیتورینگ لاگ‌ها، ابزارهای مختلفی با نقش‌های مشخص استفاده می‌شوند. Elasticsearch یک موتور جستجوی توزیع‌شده و قدرتمند است که برای ذخیره‌سازی، ایندکس‌گذاری و جستجوی سریع در حجم بالایی از لاگ‌ها استفاده می‌شود. Kibana به‌عنوان رابط کاربری گرافیکی برای Elasticsearch، امکان نمایش، فیلتر، مصورسازی و مانیتورینگ لاگ‌ها و متریک‌ها را فراهم می‌کند. Fluentd یک جمع‌آور و پردازشگر لاگ انعطاف‌پذیر است که می‌تواند لاگ‌ها را از منابع مختلف دریافت، پردازش و به مقصدهایی مانند Elasticsearch ارسال کند. برخلاف Logstash که برای پردازش‌های پیچیده و سنگین‌تر مناسب است، Fluentd سبک‌تر و مناسب‌تر برای اغلب نیازهای جمع‌آوری لاگ است. در کنار آن‌ها، خانواده Beats (مانند Filebeat، Metricbeat، Packetbeat و ...) ابزارهایی سبک‌وزن و تک‌منظوره هستند که اطلاعات مختلفی مانند لاگ فایل‌ها، وضعیت سیستم، ترافیک شبکه و وضعیت سرویس‌ها را جمع‌آوری کرده و معمولاً به Fluentd یا مستقیم به Elasticsearch ارسال می‌کنند. این ابزارها در کنار هم یک استک قدرتمند و مقیاس‌پذیر برای مانیتورینگ و تحلیل لاگ‌ها تشکیل می‌دهند.  
✔️ Elasticsearch (ذخیره و جستجو لاگ‌ها)   
✔️ Kibana (نمایش، فیلتر و مانیتورینگ لاگ‌ها)  
✔️ Fluentd (جمع آموری و پردازش لاگ ها)  
❌ Logstash (وقتی پردازش سنگین‌تری لازمه)  
✔️ Beats  
▫️Filebeat (جمع‌آوری لاگ‌های مانند Apache/nginx logs، PHP error logs, ...)  
▫️Metricbeat (جمع‌آوری متریک‌های سیستم و پایگاه داده مانند CPU، RAM، query load, ...)  
▫️Packetbeat (ضبط و تحلیل ترافیک لایه شبکه و اپلیکیشن مانند HTTP, MySQL, DNS, ... )  
▫️Heartbeat (پینگ و بررسی وضعیت سلامت سرویس‌ها)  
▫️Auditbeat (بررسی امنیتی سیستم: تغییرات فایل، یوزرها، دسترسی‌ها)  

برای نصب ابزارهای لاگ در صورت نیاز از دستور زیر استفاده کنید
```bash
cd logs
sudo docker compose up -d
```

جهت مشاهده لاگ ها به آدرس زیر بروید
```
http://kibana:5601/
```

---

### 🦊 ساخت Token برای اتصال به GitLab
جهت دریافت توکت در گیت لب به مسیر زیر بروید
```
GitLab >> Preferences >> Access tokens >> Add new token
```
و توکن بدست امده را در فایل inventory_file.yml و در متغیر gitlab_token بنویسید

---

### 🛠️ نصب ابزارهای مورد نیاز
```bash
sudo apt update
sudo apt-get install cron
sudo apt install gzip
sudo apt install tar
sudo apt install curl
sudo apt install mysql-client
sudo apt install postgresql-client
```

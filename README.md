## IaC (Infrastructure as Code)
IaC (Infrastructure as Code) به مفهومی اشاره دارد که زیرساخت‌های سیستم‌ها، شبکه‌ها، سرورها و سایر منابع فناوری اطلاعات به صورت کد مدیریت و پیکربندی می‌شوند. در این روش، به جای انجام دستی تنظیمات یا نصب و پیکربندی اجزا، همه این فرآیندها با استفاده از کدهای قابل اجرایی مانند اسکریپت‌ها یا فایل‌های پیکربندی انجام می‌شود. این رویکرد به کاهش خطاهای انسانی، افزایش تکرارپذیری و انعطاف‌پذیری در محیط‌های تولید کمک می‌کند و همچنین امکان اتوماسیون کامل فرآیندهای پیکربندی و مدیریت زیرساخت را فراهم می‌کند.

### Ansible
Ansible یکی از ابزارهای محبوب برای پیاده‌سازی IaC است که برای اتوماسیون و مدیریت پیکربندی سیستم‌ها و سرورها استفاده می‌شود. این ابزار به‌وسیله‌ی زبان YAML (که به سادگی قابل فهم است) برای تعریف دستورالعمل‌ها و سناریوهای پیکربندی به کار می‌رود و به دلیل سادگی در استفاده و قابلیت مقیاس‌پذیری بالا محبوب است. Ansible بدون نیاز به نصب نرم‌افزار خاص روی سرورهای هدف، از طریق SSH به سیستم‌ها متصل می‌شود و عملیات مورد نظر را انجام می‌دهد، این ویژگی باعث می‌شود که آن را برای پروژه‌های کوچک تا بزرگ مناسب و قابل انعطاف کند.

---

### نصب آنسیبل
جهت نصب Ansible دستورات زیر را اجرا کنید.

```bash
sudo apt update
sudo apt install software-properties-common
sudo add-apt-repository ppa:ansible/ansible
sudo apt update

sudo apt install ansible -y
sudo apt install ansible-lint -y

ansible --version
ansible-lint --version
```

### نصب داکر
برای نصب Docker با استفاده از پکیج‌ها، فایل [install_docker.sh](./install_docker.sh) را اجرا کنید.

### نصب کرون
برای بررسی و نصب کرون در صورت عدم وجود، از دستور زیر استفاده کنید:

```bash
sudo apt-get install -y cron || sudo apt-get install cron
```

---

### مراحل تنظیم SSH Key برای اتصال به GitLab

**ایجاد SSH Key**

```bash
ssh-keygen -t rsa -b 4096 -C "samad.elmakchi@gmail.com"
```
این دستور یک جفت کلید SSH (یک کلید خصوصی و یک کلید عمومی) ایجاد می‌کند. برای ذخیره‌سازی، می‌توانید مکان پیش‌فرض `(~/.ssh/id_rsa)` را بپذیرید.

**اضافه کردن کلید عمومی به GitLab**

```bash
cat ~/.ssh/id_rsa.pub
```
به GitLab بروید، به تنظیمات کاربری خود (User Settings) بروید و به بخش SSH Keys بروید.

کلید عمومی را در بخش Add SSH Key قرار دهید و سپس کلید را اضافه کنید.

**بررسی اتصال SSH به GitLab**

برای بررسی صحت اتصال به GitLab با استفاده از SSH، می‌توانید از دستور زیر استفاده کنید:

```bash
ssh -T git@gitlab.com
```
اگر اتصال به درستی انجام شود، پیامی مشابه به این دریافت خواهید کرد:

```bash
Welcome to GitLab, @your_username!
```

---

### اجرای پلی بوک آنسیبل
```bash
ansible-playbook -i inventory_file playbook.yml
```
---

### راهنمای جامع آنسیبل
برای آشنایی بیشتر با دستورات انسیبل، فایل [Ansible Cheat Sheet](./ansible_cheat_sheet.md) را مطالعه کنید.


# SMD : چک کند اگر پوشه ها و فایل ها نباشد درست کند
# SMD : فقط یکبار لاگین کند و ناقص است
# SMD : برای کالیبری، پرتال و پرتال فرانت اند تگ و برنچ مستقل
# SMD : کپی فایل داکر کامپوز برای هر مشتری
# SMD : چک کند اگر فایل ها نباشند ایجاد بکند
# SMD : قبل از اجرای داکر کامپز یک بکاپ از همه پایگاه داده های ان مشتری بگیرد
# SMD : چک کند اگر شبکه نباشد درست کند
# SMD : اگر کامپوز ها اپ باشد این اجرا بشود : قبل از اجرای داکر کامپوز docker compose -o inventory_hostname down
# SMD : میگریشن در کانتینر پرتال و نصب کامپوزر
# SMD : اگر فایل نباشد کپی بکند

# SMD : تست کلی روی سیستم خودم
# SMD : تقسیم فایل پلی بوک به چند فایل

# SMD : کد همه تست ها مانده است
# SMD : همه فایل های لاگ را در fluentd هم ذخیره بکنه
# SMD : اضافه کردن مونگو و سایر پایگاه داده ها